version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Cleaning up to fix Rollup native dependencies issue"
        - echo "Switching to Node 20 LTS to avoid npm optional deps bug"
        - nvm install 20 || true
        - nvm use 20 || true
        - node -v && npm -v
        - npm config set optional true
        - npm config set prefer-offline false
        - npm cache clean --force || true
        - rm -rf ~/.npm || true
        - rm -rf node_modules package-lock.json
        - export NPM_CONFIG_OPTIONAL=true
        - npm install
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths: []
customHeaders:
  - pattern: '**'
    headers:
      - key: 'Content-Security-Policy'
        value: "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.amazonaws.com; connect-src 'self' https://*.amazonaws.com https: http: ws: wss:; img-src 'self' data: https: http: blob:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; frame-src 'self'"
